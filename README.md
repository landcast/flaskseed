# flaskseed 

## flask template project for e-learning

![Build Status](https://travis-ci.org/landcast/flaskseed.svg?branch=master)
[![Code Health](https://landscape.io/github/landcast/flaskseed/master/landscape.svg?style=flat)](https://landscape.io/github/landcast/flaskseed/master)
[![Coverage Status](https://coveralls.io/repos/github/landcast/flaskseed/badge.svg?branch=master)](https://coveralls.io/github/landcast/flaskseed?branch=master)
<a target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=landcast%40163%2ecom&amp;lc=BR&amp;item_name=flaskseed&amp;no_note=0&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHostedGuest"><img alt='Donate with Paypal' src='http://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif' /></a>

## Background

This is a sample web project based on flask. The business model is for
e-learning. It reference much from sandman2 project on github. The main
purpose is to depict the correct way to setup python open-source projects.

## Environment

Python 3.6 with flask. Recommand to use pyenv and virtualenv to manage python
versions.

Mysql with account root:lt7116 located at localhost:3306.

Redis with no authorization check located at localhost:6379.

Future will add elastic-search for document storing and searching.


## Build Tool

Using pybuilder for project building, this tool inspired much by java maven.

```
$> pip install -r ./requirements.txt
$> pyb clean
$> pyb
```

The ./target folder contains output, and I add a custom task to copy setup.py
from ./target to ./

## CI

Using travis-ci for project continuous integration, click Build button for 
detailed information.

![Build Status](https://travis-ci.org/landcast/flaskseed.svg?branch=master)
(https://travis-ci.org/landcast/flaskseed)

## Structure

./src main source of web application ustutor (e-learning).

./doc document will be generated by SPHINX.

./scripts *.py which will be run on $> pip setup.py install

./dbrecreate.sh will drop database and recreate it.

./dbmigrate using flask-migrate for database incremental change.

./debug-flaskseed.sh will do debug start and tail the log. If log file location
changed in ./config/settings, do remember to change the log file location in
this script also.

./ali-eip-run.sh for detect elastic ip of cloud host when start service.

./sql sql file generated by above db*.sh.

./unittests for unit test case. Using $> python -m unittest unittests/*.py to
run all.

./integrationtests using python unittest to call os command curl to test the 
endpoints.

./.travis.yml CI setting for github travis-ci integration.

./build.py pybuilder tool config, which control the whole build procedure.

./setup.py for ```$> python setup.py install```, generated by pybuilder

./requirements.txt for ```$> pip install -r requirements.txt```, generated by
pigar(```$> pip install pigar && $> pigar```). Because pigar get dependency by
scan *.py file, it can't find pymysql dependency, so 'pymysql' is added 
mannually into requirements.txt

./Makefile currently not used.

./tox.ini currently not used.

./flaskseed.pid when call run.py, the process id will be write into. 

/var/log/flaskseed-debug.log is the default debug log file, tail -f for it.

## Data Model

Manually written for table generation and SQLAlchemy modeling. The common_models
is the fundamental ware for other business domain model to subclass.

## Other Storage

Currently involve redis for cache and flash storage. Elastic search will be 
added in future.

## Restful

```./ustutor/resources``` contains endpoint created by flask-restful.

## Restless

Using flask-restless to generate restful endpoint for every model in models.
In ```./ustutor/__init__.py``` setup_api function using reflection method to 
control automated api endpoint generation.

For performance consideration, we added /_bare/model_class api for single table 
query without cascading.
When front-end client just want to get single table column data without 
relations, /_bare/model_class url should be used.

## Swagger

Please notice that the swagger api version is openapi-v3.

In ./ustutor/swaggerapis, the ```__init__.py``` created swagger.json data 
structure with /auth preset in. Other model level rest-less apis are generated 
with code by reflection.

To access swagger api, open http://localhost:5000/swagger in browser.


## Authentication

JWT authentication used here, the code are distributed in 
```./ustutor/__init__.py```. The intercept policy controlled by 
auth_check_needed function, and jwt handled in jwt_check function.

## Authorization

Table controlled authorization, using RoleDefinition, RoleAuth, SysUserRole to do that.

## Deployment with uwsgi and nginx

TODO:

